{"version":3,"file":"vite-config.js","sourceRoot":"","sources":["../vite-config.ts"],"names":[],"mappings":"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","sourcesContent":["import * as path from 'path';\nimport { Plugin } from 'vite';\nimport { allowedEnvPrefix as envPrefix } from './envs';\nimport { TypescriptConfig } from '@storybook/core-common';\nimport { mockCoreJs } from './mock-core-js';\nimport { codeGeneratorPlugin } from './code-generator-plugin';\nimport { injectExportOrderPlugin } from './inject-export-order-plugin';\nimport { mdxPlugin } from './mdx-plugin';\nimport { sourceLoaderPlugin } from './source-loader-plugin';\n\nimport type { UserConfig } from 'vite';\nimport type { ExtendedOptions } from './types';\n\nexport type PluginConfigType = 'build' | 'development';\n\n// Vite config that is common to development and production mode\nexport async function commonConfig(\n  options: ExtendedOptions,\n  _type: PluginConfigType\n): Promise<UserConfig & { configFile: false; root: string }> {\n  const { framework } = options;\n\n  return {\n    configFile: false,\n    root: path.resolve(options.configDir, '..'),\n    cacheDir: 'node_modules/.vite-storybook',\n    envPrefix,\n    define: {},\n    resolve:\n      framework === 'vue3'\n        ? {\n            alias: {\n              vue: 'vue/dist/vue.esm-bundler.js',\n            },\n          }\n        : {},\n    plugins: await pluginConfig(options, _type),\n  };\n}\n\nexport async function pluginConfig(options: ExtendedOptions, _type: PluginConfigType) {\n  const { framework, presets } = options;\n  const svelteOptions = await presets.apply('svelteOptions', {}, options);\n\n  const plugins = [\n    codeGeneratorPlugin(options),\n    mockCoreJs(),\n    sourceLoaderPlugin(),\n    mdxPlugin(),\n    injectExportOrderPlugin,\n  ] as Plugin[];\n  if (framework === 'vue' || framework === 'vue3') {\n    try {\n      const vuePlugin = require('@vitejs/plugin-vue');\n      plugins.push(vuePlugin());\n      const { vueDocgen } = await import('./plugins/vue-docgen');\n      plugins.push(vueDocgen());\n    } catch (err) {\n      if ((err as NodeJS.ErrnoException).code !== 'MODULE_NOT_FOUND') {\n        throw new Error(\n          'storybook-builder-vite requires @vitejs/plugin-vue to be installed ' +\n            'when using @storybook/vue or @storybook/vue3.' +\n            '  Please install it and start storybook again.'\n        );\n      }\n      throw err;\n    }\n  }\n  if (framework === 'svelte') {\n    try {\n      const sveltePlugin = require('@sveltejs/vite-plugin-svelte').svelte;\n      plugins.push(sveltePlugin(svelteOptions));\n    } catch (err) {\n      if ((err as NodeJS.ErrnoException).code !== 'MODULE_NOT_FOUND') {\n        throw new Error(\n          'storybook-builder-vite requires @sveltejs/vite-plugin-svelte to be installed when using @storybook/svelte.' +\n            '  Please install it and start storybook again.'\n        );\n      }\n      throw err;\n    }\n\n    try {\n      const csfPlugin = require('./svelte/csf-plugin').default;\n      plugins.push(csfPlugin(svelteOptions));\n    } catch (err) {\n      if ((err as NodeJS.ErrnoException).code !== 'MODULE_NOT_FOUND') {\n        throw new Error(\n          'storybook-builder-vite requires @storybook/addon-svelte-csf to be installed when using @storybook/svelte.' +\n            '  Please install it and start storybook again.'\n        );\n      }\n      throw err;\n    }\n  }\n\n  if (framework === 'react') {\n    plugins.push(\n      require('@vitejs/plugin-react')({\n        // Do not treat story files as HMR boundaries, storybook itself needs to handle them.\n        exclude: [/\\.stories\\.([tj])sx?$/, /node_modules/],\n      })\n    );\n\n    const { reactDocgen, reactDocgenTypescriptOptions } = await presets.apply('typescript', {} as TypescriptConfig);\n\n    let typescriptPresent;\n\n    try {\n      require.resolve('typescript');\n      typescriptPresent = true;\n    } catch (e) {\n      typescriptPresent = false;\n    }\n\n    if (reactDocgen === 'react-docgen-typescript' && typescriptPresent) {\n      plugins.push(require('@joshwooding/vite-plugin-react-docgen-typescript').default(reactDocgenTypescriptOptions));\n    }\n  }\n\n  if (framework === 'glimmerx') {\n    const plugin = require('vite-plugin-glimmerx/index.cjs');\n    plugins.push(plugin.default());\n  }\n\n  return plugins;\n}\n"]}